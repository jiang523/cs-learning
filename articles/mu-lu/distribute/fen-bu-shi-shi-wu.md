# 分布式事务

## 两阶段提交

* 协调者
* 参与者

&#x20;准备阶段: 协调者向每个参与者发送准备请求，每个参与者执行自己的数据变更，但是不提交本地事务，变更完成后向协调者发送确认请求

提交阶段: 如果所有参与者都发送了成功的确认请求，协调者通知所有参与者提交本地事务。如果存在本地事务执行失败的参与者，协调者通知所有参与者回滚事务。

## TCC

try-confirm-cancel

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

存在的问题

* 实现很复杂，且需要对业务代码做侵入
* 存在事务悬挂问题，部分子事务成功部分失败，无法回滚
* 会造成空回滚，对于try失败的子事务也需要cancel，此时就是空回滚

## 本地消息表

对重要的事务先做提交，然后发送一条消息到数据库或者Mq

## 最大努力通知

